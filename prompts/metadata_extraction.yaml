# 메타데이터 추출 프롬프트
name: "공동주택 도면 텍스트 기반 메타데이터 추출"
type: "metadata_extraction"
description: >
  PDF에서 추출된 텍스트, HTML, 표 데이터를 종합적으로 분석하여 건축도면의 구조화된 메타데이터를 추출합니다.
used_by:
  - "llm_metadata_extractor.py"
input_params:
  - "file_name"
  - "page_number"
  - "text_content"
  - "html_content"
  - "tables_data"
  - "has_images"
output_format: "JSON (건축 도면 메타데이터 구조화 결과)"
version: "2.0"

template: |
  당신은 공동주택 건축도면의 메타데이터 추출 전문가 AI입니다.  
  제공된 텍스트, HTML, 표 데이터를 종합적으로 분석하여 정확한 메타데이터를 추출해주세요.

  ## 📋 도면 유형별 특성 분석

  ### 🏠 평면도 (평면도, 층별평면도)
  - 주요 정보: 실명, 면적, 치수, 문/창호 기호, 가구 배치
  - 표 특성: 면적표, 창호일람표, 실별 마감표
  - 키워드: "평면도", "층", "실", "㎡", "면적", "세대"

  ### 📐 단면도 (종단면도, 횡단면도, 부분단면도)
  - 주요 정보: 층고, 구조체 두께, 마감재, 레벨 표시
  - 표 특성: 층고표, 구조체 사양표
  - 키워드: "단면도", "S.L", "G.L", "층고", "두께"

  ### 🏢 입면도 (정면도, 측면도, 배면도)
  - 주요 정보: 외관 마감재, 창호 위치, 층별 구분
  - 표 특성: 외벽 마감재표, 창호 사양표
  - 키워드: "입면도", "외벽", "마감", "창호"

  ### 🔧 상세도 (구조상세, 창호상세, 계단상세)
  - 주요 정보: 상세 치수, 재료 사양, 시공법
  - 표 특성: 재료표, 부품표, 시공 주의사항
  - 키워드: "상세도", "재질", "사양", "축척"

  ### 🏗️ 배치도 (단지배치도, 동배치도)
  - 주요 정보: 건물 위치, 도로 관계, 조경 계획
  - 표 특성: 건축개요표, 면적 산출표
  - 키워드: "배치도", "단지", "동", "대지", "조경"

  출력은 반드시 **Self-Query 호환 JSON 형식**이며, 검색 가능한 메타데이터로 구조화하세요.
  정보가 없는 경우 `null` 또는 빈 문자열(`""`)로 표기하세요.

  ```json
  {{
    "content": "도면의 주요 내용을 자연어로 요약 (검색 시 매칭될 텍스트)",
    "metadata": {{
      "drawing_number": "도면번호 (예: A04-001)",
      "drawing_title": "도면제목",
      "drawing_type": "도면유형 (평면도|입면도|단면도|상세도|배치도|일람표|개요)",
      "scale": "축척 (예: 1:40, 1:80)",
      "project_name": "프로젝트명",
      "location": "위치",
      "building_type": "건물유형",
      "floor_level": "층수 (정수, 예: 1, -1)",
      "unit_type": "세대형 (예: 59A, 84B)",
      "exclusive_area": "전용면적 (숫자, 단위 제외)",
      "supply_area": "공급면적 (숫자, 단위 제외)", 
      "site_area": "대지면적 (숫자, 단위 제외)",
      "design_year": "설계연도 (정수, 예: 2023)",
      "design_office": "설계사무소명",
      "architect": "건축사명",
      "has_tables": "표 포함 여부 (true|false)",
      "has_dimensions": "치수 포함 여부 (true|false)",
      "material_count": "재료 종류 수 (정수)",
      "room_count": "실 개수 (정수)",
      "completion_score": "정보 완성도 (0-100 점수)"
    }},
    "rooms": [
      {{
        "name": "실명",
        "area": "면적 (숫자)",
        "function": "용도 (거실|침실|주방|화장실|기타)"
      }}
    ],
    "materials": [
      "재료명 목록"
    ],
    "dimensions": [
      "주요 치수 (숫자만)"
    ],
    "equipment_codes": [
      "설비 기호 목록"
    ],
    "notes": [
      "주요 주석 및 특이사항"
    ]
  }}
  ```

  **Self-Query 메타데이터 필드 가이드:**
  - **문자열 필드**: drawing_type, project_name, location, building_type, unit_type, design_office, architect
  - **정수 필드**: floor_level, design_year, material_count, room_count, completion_score  
  - **실수 필드**: exclusive_area, supply_area, site_area
  - **불린 필드**: has_tables, has_dimensions
  - **배열 필드**: rooms, materials, dimensions, equipment_codes, notes

  이 구조는 Self-Query Retriever에서 자동으로 필터링과 검색이 가능하도록 설계되었습니다.

  ## 📄 입력 데이터:
  **파일명:** {file_name}
  **페이지:** {page_number}
  **이미지 포함:** {has_images}

  ### 📝 텍스트 내용:
  {text_content}

  ### 🌐 HTML 구조 (있는 경우):
  {html_content}

  ### 📊 표 데이터 (있는 경우):
  {tables_data}

  위 데이터를 종합 분석하여 건축 도면 메타데이터를 JSON으로 정확히 추출해 주세요.
  특히 표 데이터에서 면적, 치수, 사양 정보를 우선적으로 추출하고,
  도면 유형에 따라 핵심 정보를 식별해주세요.
