# π“ VLM ν”„λ΅¬ν”„νΈ κ΄€λ¦¬ κ°€μ΄λ“

μ΄ λ””λ ‰ν† λ¦¬λ” VLM κ±΄μ¶• λ„λ©΄ λ¶„μ„ μ‹μ¤ν…μ—μ„ μ‚¬μ©ν•λ” λ¨λ“  LLM ν”„λ΅¬ν”„νΈλ¥Ό κ΄€λ¦¬ν•©λ‹λ‹¤.

## π“ λ””λ ‰ν† λ¦¬ κµ¬μ΅°

```
prompts/
β”β”€β”€ README.md                    # μ΄ νμΌ
β”β”€β”€ config.yaml                 # ν”„λ΅¬ν”„νΈ μ‹μ¤ν… μ„¤μ •
β”β”€β”€ metadata_extraction.yaml    # PDF/DWG λ©”νƒ€λ°μ΄ν„° μ¶”μ¶ ν”„λ΅¬ν”„νΈ
β”β”€β”€ convert_to_self_query.yaml  # Self-Query ν•νƒ λ³€ν™ ν”„λ΅¬ν”„νΈ
β”β”€β”€ rag_query.yaml             # RAG μ§μμ‘λ‹µ ν”„λ΅¬ν”„νΈ
β”β”€β”€ system_test.yaml           # μ‹μ¤ν… ν…μ¤νΈ ν”„λ΅¬ν”„νΈ
β””β”€β”€ gemma_chat_wrapper.yaml    # Gemma μ±„ν… λνΌ ν”„λ΅¬ν”„νΈ
```

## π”§ ν”„λ΅¬ν”„νΈ νμΌ ν•μ‹

κ° ν”„λ΅¬ν”„νΈ νμΌμ€ YAML ν•μ‹μΌλ΅ μ‘μ„±λλ©° λ‹¤μ κµ¬μ΅°λ¥Ό λ”°λ¦…λ‹λ‹¤:

```yaml
# ν”„λ΅¬ν”„νΈ μ„¤λ… (μ£Όμ„)
name: "ν”„λ΅¬ν”„νΈ μ΄λ¦„"
type: "ν”„λ΅¬ν”„νΈ μ ν•"
description: "ν”„λ΅¬ν”„νΈ μ„¤λ…"
used_by:
  - "μ‚¬μ©ν•λ” λ¨λ“λ…1.py"
  - "μ‚¬μ©ν•λ” λ¨λ“λ…2.py"
input_params:
  - "νλΌλ―Έν„°1"
  - "νλΌλ―Έν„°2"
output_format: "μμƒ μ¶λ ¥ ν•μ‹"
version: "1.0"

template: |
  μ‹¤μ  ν”„λ΅¬ν”„νΈ λ‚΄μ©
  {νλΌλ―Έν„°1}μ„ μ‚¬μ©ν• ν…ν”λ¦Ώ
  {νλΌλ―Έν„°2}λ„ ν¬ν•¨ κ°€λ¥
```

## π“ ν”„λ΅¬ν”„νΈ μμ • κ°€μ΄λ“

### 1. κΈ°μ΅΄ ν”„λ΅¬ν”„νΈ μμ •
μ›ν•λ” ν”„λ΅¬ν”„νΈ νμΌμ„ μ§μ ‘ νΈμ§‘ν•λ©΄ λ©λ‹λ‹¤.

```bash
# μ: λ©”νƒ€λ°μ΄ν„° μ¶”μ¶ ν”„λ΅¬ν”„νΈ μμ •
vim prompts/metadata_extraction.yaml
```

### 2. μƒ ν”„λ΅¬ν”„νΈ μ¶”κ°€
1. μƒ YAML νμΌ μƒμ„±
2. `config.yaml`μ `prompt_files` μ„Ήμ…μ— μ¶”κ°€
3. ν•„μ”μ‹ `prompt_types`μ— μƒ μ ν• μ¶”κ°€

### 3. νλΌλ―Έν„° λ³€κ²½
- `input_params` λ¦¬μ¤νΈ μμ •
- `template`μ—μ„ ν•΄λ‹Ή νλΌλ―Έν„° μ‚¬μ©/μ κ±°
- κ΄€λ ¨ μ½”λ“μ—μ„λ„ νλΌλ―Έν„° λ³€κ²½ ν•„μ”

## π― ν”„λ΅¬ν”„νΈλ³„ μƒμ„Έ μ„¤λ…

### metadata_extraction.yaml
- **λ©μ **: PDF/DWG νμΌμ—μ„ κ±΄μ¶• λ„λ©΄ λ©”νƒ€λ°μ΄ν„° μ¶”μ¶
- **μ‚¬μ© λ¨λ“**: `llm_metadata_extractor.py`, `extract_metadata_unified.py`
- **μ¶λ ¥**: JSON ν•μ‹μ κµ¬μ΅°ν™”λ λ©”νƒ€λ°μ΄ν„° (Self-Query νΈν™)
- **ν•µμ‹¬ νλΌλ―Έν„°**: `file_name`, `page_number`, `text_content`, `html_content`, `tables_data`

### convert_to_self_query.yaml
- **λ©μ **: κΈ°μ΅΄ λ©”νƒ€λ°μ΄ν„°λ¥Ό Self-Query ν•νƒλ΅ λ³€ν™
- **μ‚¬μ© λ¨λ“**: `extract_metadata_unified.py`
- **μ¶λ ¥**: Self-Query Retriever νΈν™ JSON ν•μ‹
- **ν•µμ‹¬ νλΌλ―Έν„°**: `old_metadata_json`

### rag_query.yaml
- **λ©μ **: RAG μ‹μ¤ν… μ§μμ‘λ‹µ
- **μ‚¬μ© λ¨λ“**: `query_rag.py`
- **μ¶λ ¥**: μμ—°μ–΄ λ‹µλ³€
- **ν•µμ‹¬ νλΌλ―Έν„°**: `retrieved_documents_text`, `query_text`

### system_test.yaml
- **λ©μ **: LLM μ—°κ²° λ° μ‹μ¤ν… ν…μ¤νΈ
- **μ‚¬μ© λ¨λ“**: ν…μ¤νΈ μ¤ν¬λ¦½νΈλ“¤
- **μ¶λ ¥**: κ°„λ‹¨ν• μ‘λ‹µ
- **νλΌλ―Έν„°**: μ—†μ

### gemma_chat_wrapper.yaml
- **λ©μ **: Gemma λ¨λΈμ© μ±„ν… ν•μ‹ λν•‘
- **μ‚¬μ© λ¨λ“**: `query_rag.py`
- **μ¶λ ¥**: μ±„ν… ν•μ‹ ν…μ¤νΈ
- **ν•µμ‹¬ νλΌλ―Έν„°**: `system_message`, `user_message`

## π”„ ν”„λ΅¬ν”„νΈ λ²„μ „ κ΄€λ¦¬

### λ²„μ „ μ—…λ°μ΄νΈ
ν”„λ΅¬ν”„νΈλ¥Ό μμ •ν•  λ•λ” `version` ν•„λ“λ¥Ό μ—…λ°μ΄νΈν•μ„Έμ”:

```yaml
version: "1.1"  # λ§μ΄λ„ μμ •
version: "2.0"  # λ©”μ΄μ € λ³€κ²½
```

### λ°±μ—… κ¶μ¥μ‚¬ν•­
μ¤‘μ”ν• λ³€κ²½ μ „μ—λ” λ°±μ—…μ„ μƒμ„±ν•μ„Έμ”:

```bash
cp metadata_extraction.yaml metadata_extraction.yaml.backup
```

## π§ ν”„λ΅¬ν”„νΈ ν…μ¤νΈ

ν”„λ΅¬ν”„νΈ λ³€κ²½ ν›„ λ°λ“μ‹ ν…μ¤νΈν•μ„Έμ”:

```bash
# ν”„λ΅¬ν”„νΈ λ§¤λ‹μ € ν…μ¤νΈ
python src/prompt_manager.py

# μ „μ²΄ μ‹μ¤ν… ν…μ¤νΈ
python test_ollama_integration.py
```

## β οΈ μ£Όμμ‚¬ν•­

1. **νλΌλ―Έν„° μΌμΉ**: μ½”λ“μ—μ„ μ‚¬μ©ν•λ” νλΌλ―Έν„°μ™€ YAML νμΌμ `input_params`κ°€ μΌμΉν•΄μ•Ό ν•©λ‹λ‹¤.

2. **νΉμ λ¬Έμ**: YAMLμ—μ„ `{`, `}` λ“±μ€ μ΄μ¤μΌ€μ΄ν”„κ°€ ν•„μ”ν•  μ μμµλ‹λ‹¤.

3. **μΈμ½”λ”©**: λ¨λ“  νμΌμ€ UTF-8λ΅ μ €μ¥ν•μ„Έμ”.

4. **λ“¤μ—¬μ“°κΈ°**: YAMLμ€ λ“¤μ—¬μ“°κΈ°μ— λ―Όκ°ν•λ―€λ΅ μ£Όμν•μ„Έμ”.

## π”— κ΄€λ ¨ νμΌ

- `src/prompt_manager.py`: ν”„λ΅¬ν”„νΈ λ΅λ” λ° κ΄€λ¦¬μ
- `src/llm_metadata_extractor.py`: λ©”νƒ€λ°μ΄ν„° μ¶”μ¶ λ¨λ“
- `extract_metadata_unified.py`: ν†µν•© λ©”νƒ€λ°μ΄ν„° μ¶”μ¶ μ¤ν¬λ¦½νΈ
- `query_rag.py`: RAG μ§μμ‘λ‹µ CLI λ„κµ¬

---

π’΅ **ν**: ν”„λ΅¬ν”„νΈλ¥Ό μμ •ν•  λ•λ” μ‘μ€ λ³€κ²½λ¶€ν„° μ‹μ‘ν•΄μ„ μ μ§„μ μΌλ΅ κ°μ„ ν•λ” κ²ƒμ΄ μΆ‹μµλ‹λ‹¤.
